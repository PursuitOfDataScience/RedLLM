# Dream of the Red Chamber LLM Pretraining

This project is dedicated to pretraining a large language model (LLM) on the classic Chinese novel *Dream of the Red Chamber* (红楼梦). This classic 18th-century novel, written by Cao Xueqin, is my favoriate Chinese classical literature and offers a rich tapestry of character studies, intricate relationships, and profound insights into Qing Dynasty society, making it an ideal corpus for training a language model with a deep understanding of classical Chinese literature and cultural nuance. By leveraging this timeless masterpiece, the goal is to capture its rich narrative style, intricate language, and cultural nuances in a transformer-based model. 

## Overview for 1st pretraining

- **Dataset**: Chapters 1-80 from *Dream of the Red Chamber* (红楼梦) [download link](https://archive.org/details/20210205_20210205_1123/page/16/mode/2up?utm_source=chatgpt.com)
- **Model Architecture**: A GPT-style transformer configured with:
  - **vocab_size**: 5000 tokens
  - **block_size**: 1024 (context window size)
  - **n_layer**: 12 transformer layers
  - **n_head**: 12 attention heads per layer
  - **n_embd**: 768-dimensional embeddings
  - **dropout**: 0.1
  - **mixed_precision_training**: True
  - **training_type**: DDP
- **Total Parameters**: 157.58 million

## Features

- **Pretraining Objective**: The model is trained in a self-supervised manner to predict the next token, learning the unique style and language of the text.
- **Tokenizer**: Uses a custom tokenizer (with `vocab.json` and `merges.txt`) tailored for classical Chinese.
- **Inference**: Once pretrained, the model can generate text in the style of *Dream of the Red Chamber*, providing insights into classical literature with modern language modeling techniques.

## Compute
1 DGX A100 node with 8 GPUs (each with 80G HBM) to run `pretrain.py`. The entire script took 3.3 hours to finish after runnig for 1500 epochs with batch size 32 and learning rate 3e-5.

![](images/hongloumeng-0219.png)


## Sample Generated Text

Below is an example of text generated by our pre-trained LLM using the "Dream in Red Chamber" dataset:

<pre>
花袭人有始有终，若说必不缁，或弹压倒，倘有这等无怨色，只怕连我也不肯带累咱们，一面说，一面总误认了那妒芳官梳头，还骷害羞激你。可知人的不是人家的好里头，叫个人往你吃醉了，我再不过去了。如今三姑娘虽见了这般，且又有了病，只管告诉大奶奶，多说几天，一定又是一场事。嫂子的娘，都告诉了他，他们更妥当了。” 
　　正说著，只见林之孝家的进来说：“快回大奶奶那里请安去，说是妈在厅上姨太太这里晓得讨主意。我们大家纳闷，也不过为此言，容他话，因笑道：“叔叔怎么就这样知礼，正理你说去！便是请太太的安去，你叫他同秦相公们嬉游的。”说著，一径去了。 
　　这里柳家的见宝玉辞了贾母出来，丫鬟们都在院内纳凉爽之时，探春在内。可巧遇见凤姐儿那边犄著院门，手里拿著一张当票，命蕊官拿著一张椅上。宝玉笑向宝钗，黛玉，宝玉四人坐著，一脚踏，正欲走近前来。只见众人都替宝玉悄问：“二位姑娘救我！”黛玉纳闷，进入房中找时，只见袭人、麝月、檀云、秋纹等说：“太太叫人知道了，你们好生在这屋里，我去了就来。”宝玉听说，忙问：“怎么就没理他呢？”紫鹃道：“怨不得姑娘，进来伺侯。”一面说，一面都去了。 
　　黛玉坐在床上，一面抬手整理鬓发，一面笑向宝玉道：“人家睡觉，你进来作什么？”宝玉见他星眼微饧，香腮带赤，不觉神魂早荡，一歪身坐在椅子上，笑道：“你才说什么？”黛玉道：“我没说什么。”宝玉笑道：“给你个榧子吃！我都听见了。” 
　　二人正说话，只见紫鹃进来。宝玉笑道：“紫鹃，把你们的好茶倒碗我吃。”紫鹃道：“那里是好的呢？要好的，只是等袭人来。”黛玉道：“别理他，你先给我舀水去罢。”紫鹃笑道：“他是客，自然先倒了茶来再舀水去。”说著倒茶去了。宝玉笑道：“好丫头，‘若共你多情小姐同鸳帐，怎舍得叠被舖床？’”林黛玉登时撂下脸来，说道：“二哥哥，你说什么？”宝玉笑道
</pre>